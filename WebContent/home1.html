<!DOCTYPE HTML>
<html>
<head>
<title>Online Shopping Website</title>

<link href="assets/css/listview.css" rel='stylesheet' type='text/css' />

<link href="assets/css/bootstrap.css" rel='stylesheet' type='text/css' />
<!-- jQuery (necessary JavaScript plugins) -->
<script type='text/javascript' src="assets/js/jquery-1.11.1.min.js"></script>
<!-- Custom Theme files -->
<link href="assets/css/style.css" rel='stylesheet' type='text/css' />
<!-- Custom Theme files -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!--webfont-->
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- start menu -->
<link href="assets/css/megamenu.css" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="assets/js/megamenu.js"></script>
<script>$(document).ready(function(){$(".megamenu").megamenu();});</script>
<!-- start slider -->
<link rel="stylesheet" href="assets/css/fwslider.css" media="all">
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/fwslider.js"></script>
<script src="assets/js/menu_jquery.js"></script>


 <script type="text/javascript">
 function getCatalog()
 {
	 alert("button clicked");
 jQuery.ajax({
     type: "POST",
     url: "http://localhost:8080/CloudServices/rest/users/getCatalog",
    // data: "101",
     contentType: "application/json; charset=utf-8",
     dataType: "json",
     success: function (data, status, jqXHR) {
     	
     	if(JSON.stringify(data["statusCode"])== 200 )
 		{
     	 	alert("Status code : "+ JSON.stringify(data["statusCode"])+"\n Status message: "+ JSON.stringify(data["statusMessage"]) );
     		alert("data: \n"+ JSON.stringify(data["catalog"])); 
     		var jsonData = JSON.parse(JSON.stringify(data["catalog"]));
     		//alert("Parse\n"+ jsonData);
     	
     	for (var i = 0; i < jsonData.length; i++) {
     		    var counter = jsonData[i];
     		    console.log(counter.catalogName);
     		    //alert("Product Name" + counter.productName+ "\t Quantity:"+ counter.quantity+"\t Product Price"+counter.productPrice)
     	
     		    newli = "<li class='catalogName' value="+counter.catalogID +">"+counter.catalogName+"</li>";
     	        $('#catalogList').append(newli); 
     		  
     		
     		} 
 			
 			}
 		else
 			{
 			alert("Status Code: "+ JSON.stringify(data["statusCode"])+"\n Status Message:"+"Error in retreiving products");
 			
 			}
 				    },

     error: function (jqXHR, status) {            
     	alert(jqXHR+" "+status);
     }

 });
 }


</script>


<script>
$(document).on('pageinit', '#home', function(){      
    var url = 'http://api.themoviedb.org/3/',
        mode = 'search/movie?query=',
        movieName = '&query='+encodeURI('Batman'),        
        key = '&api_key=470fd2ec8853e25d2f8d86f685d2270e';        
    
    $.ajax({
        url: url + mode + key + movieName ,
        dataType: "jsonp",
        async: true,
        success: function (result) {
            ajax.parseJSONP(result);
        },
        error: function (request,error) {
            alert('Network error has occurred please try again!');
        }
    });         
});

$(document).on('pagebeforeshow', '#headline', function(){      
    $('#movie-data').empty();
    $.each(movieInfo.result, function(i, row) {
        if(row.id == movieInfo.id) {
            $('#movie-data').append('<li><img src="http://d3gtl9l2a4fn1j.cloudfront.net/t/p/w185'+row.poster_path+'"></li>');
            $('#movie-data').append('<li>Title: '+row.original_title+'</li>');
            $('#movie-data').append('<li>Release date'+row.release_date+'</li>');
            $('#movie-data').append('<li>Popularity : '+row.popularity+'</li>');   
            $('#movie-data').append('<li>Popularity : '+row.vote_average+'</li>');             
            $('#movie-data').listview('refresh');            
        }
    });    
});

$(document).on('vclick', '#movie-list li a', function(){  
    movieInfo.id = $(this).attr('data-id');
    $.mobile.changePage( "#headline", { transition: "slide", changeHash: false });
});

var movieInfo = {
    id : null,
    result : null
}

var ajax = {  
    parseJSONP:function(result){  
        movieInfo.result = result.results;
        $.each(result.results, function(i, row) {
            console.log(JSON.stringify(row));
            $('#movie-list').append('<li><a href="" data-id="' + row.id + '"><img src="http://d3gtl9l2a4fn1j.cloudfront.net/t/p/w185'+row.poster_path+'"/><h3>' + row.title + '</h3><p>' + row.vote_average + '/10</p></a></li>');
        });
        $('#movie-list').listview('refresh');
    }
}


</script>



<!--end slider -->
</head>
<body>
<!-- header_top --> 
<div class="top_bg">
<div class="container">
<div class="header_top">
	<!-- <div class="top_left">
		<h2><a href="#">25%off</a> use coupon code "NEW007" and get extra 25% off on orders above 50 dollars </h2>
	</div> -->
	<div class="top_right">
		
	
		<ul>
			<li><p id= "userNameJQ" class ="UserNameJQ">Hi, </p></li>|
			<li> <p id="lastLoginTime"> Your last login time was on :</p></li>|
			<li><a href="index.html">Sign Out</a></li>
		</ul>
	</div>
	<div class="clearfix"> </div>
</div>
</div>
</div>
<!-- header -->
<div class="header_bg">
<div class="container">
	<div class="header">
	<div class="logo">
				<button class="btn btn-primary" id="getProducts" onclick="getCatalog()">CATALOG</button> 
			
			<h3>Online Shopping Stores</h3>
			
			<p>CmpE 282 - Cloud Services</p>
		</div>
		<!-- start header_right -->
		<div class="header_right">
		
		<div class="search">
		    <form>
		    	<input type="text" value="" placeholder="search">
				<input type="submit" value="">
				
			</form>
			
		</div>
		
		<div class="clearfix"> </div>
		</div>
		
		
		
		
		
		<div data-role="page" id="home">
    <div data-theme="a" data-role="header">
        <h3>
            Movie List
        </h3>
    </div>        
    <div data-role="content">
        <div class="example-wrapper" data-iscroll>
            <ul data-role="listview"  id="movie-list" data-theme="a">
                
            </ul>
        </div>
    </div>
    <div data-theme="a" data-role="footer">
        <h1>Copyright 2013</h1>
    </div>              
</div>
<div data-role="page" id="headline">
    <div data-theme="a" data-role="header">
        <a href="#home" class="ui-btn-left" data-transition="slide" data-direction="reverse">Back</a>                        
        <h3>
            Movie Info
        </h3>
    </div>        
    <div data-role="content">
        <ul data-role="listview"  id="movie-data" data-theme="a">
            
        </ul>
    </div>
</div>    
		
<!-- footer -->
<div class="footer">
 <div class="container">
	<div class="copy">
		<p class="link">&copy; All rights reserved</p>
	</div>
 </div>
</div>
</body>
</html>
